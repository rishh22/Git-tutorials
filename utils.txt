This is the utility function version 2